<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>L'Harmonie - Espace Priv√© üåô</title>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBPNfMyhIOTWyGG-ZB5pOTr-y3TA0J3B28",
            authDomain: "mon-projet062.firebaseapp.com",
            databaseURL: "https://mon-projet062-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mon-projet062",
            storageBucket: "mon-projet062.appspot.com",
            messagingSenderId: "1054174163421",
            appId: "1:1054174163421:web:50817b3c930a5eb55ac634"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Space+Grotesk:wght@500;700&display=swap');
        
        :root {
            --accent: #9b5de5;
            --bg: #05020a;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --pink: #f178ff;
            --orange: #ff9e00;
            --green: #00ff88;
            --red: #ff4444;
            --text-dim: rgba(255, 255, 255, 0.5);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0; background: var(--bg); color: #fff;
            background: radial-gradient(circle at top right, #1a0b2e, var(--bg));
            min-height: 100vh; overflow-x: hidden;
        }

        /* --- √âCRANS D'ENTR√âE (DA MISE √Ä JOUR) --- */
        #who-screen, #intro-screen {
            position: fixed; inset: 0; z-index: 2000;
            background: radial-gradient(circle at center, #13072e 0%, #05020a 100%);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center;
            transition: 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .main-title {
            font-size: 2.2rem; letter-spacing: 12px; font-weight: 800;
            background: linear-gradient(to right, #fff, var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin: 0;
        }

        .subtitle {
            font-size: 0.7rem; letter-spacing: 10px; color: var(--text-dim);
            margin-bottom: 10px; text-transform: uppercase;
        }

        .divider {
            width: 60px; height: 2px; background: var(--accent);
            margin: 25px auto 40px; border-radius: 2px;
            box-shadow: 0 0 15px var(--accent);
        }

        .who-btn {
            background: var(--glass); border: 1px solid var(--glass-border);
            padding: 20px 45px; border-radius: 50px; color: white;
            font-weight: 800; cursor: pointer; margin: 0 10px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1rem; letter-spacing: 2px; backdrop-filter: blur(15px);
        }

        .btn-rayan:hover { border-color: var(--accent); box-shadow: 0 0 30px rgba(155, 93, 229, 0.4); transform: translateY(-5px); color: var(--accent); }
        .btn-israh:hover { border-color: var(--pink); box-shadow: 0 0 30px rgba(241, 120, 255, 0.4); transform: translateY(-5px); color: var(--pink); }

        /* --- DESIGN DU C≈íUR DE SYNCHRO --- */
        #welcome-txt {
            font-weight: 800; font-size: 2.8rem; margin-bottom: 15px;
            letter-spacing: -1px; background: linear-gradient(to bottom, #fff, #ccc);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .step-label {
            opacity: 0.6; font-size: 0.75rem; letter-spacing: 4px;
            margin-bottom: 50px; text-transform: uppercase; font-weight: 600;
        }

        .pulse-btn {
            width: 130px; height: 130px; 
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid var(--accent);
            border-radius: 50%; cursor: pointer; font-size: 3.5rem;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 40px rgba(155, 93, 229, 0.2); 
            animation: pulse-glow 2s infinite; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px);
        }

        @keyframes pulse-glow { 
            0% { transform: scale(1); box-shadow: 0 0 20px rgba(155, 93, 229, 0.3); border-color: var(--accent); }
            50% { transform: scale(1.08); box-shadow: 0 0 50px rgba(155, 93, 229, 0.6); border-color: var(--pink); }
            100% { transform: scale(1); box-shadow: 0 0 20px rgba(155, 93, 229, 0.3); border-color: var(--accent); }
        }

        .hidden { opacity: 0; pointer-events: none; transform: scale(1.1); filter: blur(30px); }

        /* --- INTERFACE PRINCIPALE --- */
        header { padding: 50px 20px 30px; text-align: center; }
        .clock { font-family: 'Space Grotesk', sans-serif; font-size: 4rem; font-weight: 700; letter-spacing: -2px; }
        .countdown { font-size: 0.7rem; letter-spacing: 3px; color: var(--pink); font-weight: 700; text-transform: uppercase; margin-top: 10px; }
        .xp-container { width: 280px; height: 6px; background: rgba(255,255,255,0.05); border-radius: 10px; margin: 25px auto; overflow: hidden; }
        #xp-fill { width: 0%; height: 100%; background: linear-gradient(90deg, var(--accent), var(--pink)); transition: 1s cubic-bezier(0.17, 0.67, 0.83, 0.67); }

        .container { max-width: 1100px; margin: auto; padding: 0 25px 100px; }
        .main-grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 30px; margin-bottom: 30px; }
        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }
        
        .card { 
            background: var(--glass); border-radius: 40px; padding: 35px; 
            border: 1px solid var(--glass-border); backdrop-filter: blur(30px); 
            transition: 0.3s; position: relative;
        }

        #garden-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 6px; margin-bottom: 25px; }
        .pixel { aspect-ratio: 1; background: rgba(255,255,255,0.04); border-radius: 6px; cursor: pointer; transition: 0.2s; }
        
        .tool-bar { display: flex; gap: 12px; align-items: center; }
        .tool-btn { 
            background: var(--glass); border: 1px solid var(--glass-border); 
            color: var(--text-dim); padding: 10px 20px; border-radius: 15px; 
            cursor: pointer; font-size: 0.75rem; font-weight: 700; transition: 0.3s;
        }
        .tool-btn.active { border-color: var(--pink); color: var(--pink); background: rgba(241, 120, 255, 0.1); }

        .game-box { background: rgba(0,0,0,0.25); border-radius: 25px; padding: 25px; margin-bottom: 20px; border: 1px solid var(--glass-border); }
        .player-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .badge { font-size: 0.65rem; font-weight: 800; padding: 6px 12px; border-radius: 12px; border: 1px solid currentColor; letter-spacing: 1px; }
        
        .mood-btn { font-size: 1.4rem; cursor: pointer; opacity: 0.2; transition: 0.3s; filter: grayscale(1); margin-left: 5px; }
        .mood-btn.active { opacity: 1; filter: grayscale(0); transform: scale(1.3); text-shadow: 0 0 15px rgba(255,255,255,0.5); }

        .ttt-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 180px; margin: 20px auto; }
        .ttt-cell { 
            aspect-ratio: 1; background: rgba(255,255,255,0.03); border-radius: 15px; 
            border: 1px solid var(--glass-border); display: flex; align-items: center; 
            justify-content: center; font-size: 1.5rem; font-weight: 800; cursor: pointer; transition: 0.2s;
        }

        /* --- INTERROGATOIRE STYLES --- */
        .q-box { background: linear-gradient(135deg, rgba(155, 93, 229, 0.1), rgba(241, 120, 255, 0.05)); padding: 25px; border-radius: 30px; margin-bottom: 20px; border: 1px solid rgba(155, 93, 229, 0.2); }
        .pulse-red { animation: pulse-red-anim 2s infinite; }
        @keyframes pulse-red-anim {
            0% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0); }
        }
        @keyframes interro-spin { 100% { transform: rotate(360deg); } }

        textarea { 
            width: 100%; height: 80px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); 
            border-radius: 20px; color: #fff; padding: 18px; font-family: inherit; resize: none; 
            box-sizing: border-box; margin-bottom: 15px; transition: 0.3s; font-size: 0.9rem;
        }
        textarea:focus { border-color: var(--accent); outline: none; background: rgba(0,0,0,0.4); }

        .finish-btn { 
            width: 100%; padding: 22px; border-radius: 25px; border: none; 
            background: linear-gradient(45deg, var(--accent), var(--pink)); 
            color: white; font-weight: 800; cursor: pointer; transition: 0.4s; 
            font-size: 0.9rem; letter-spacing: 1px; margin-bottom: 10px;
        }

        #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 3000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(15px); }
        .modal-content { background: #1a0b2e; border: 1px solid var(--glass-border); padding: 50px; border-radius: 50px; text-align: center; max-width: 380px; }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; background: var(--orange); }
        .status-dot.active { background: var(--green); box-shadow: 0 0 15px var(--green); }
    </style>
</head>
<body>

    <div id="who-screen">
        <div>
            <p class="subtitle">PROJET</p>
            <h2 class="main-title">L'HARMONIE</h2>
            <div class="divider"></div>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="who-btn btn-rayan" onclick="identify('Rayan')">RAYAN</button>
            <button class="who-btn btn-israh" onclick="identify('Israh')">ISRAH</button>
        </div>
    </div>

    <div id="intro-screen" class="hidden">
        <h1 id="welcome-txt">Bonjour</h1>
        <p id="step-txt" class="step-label">SYNCHRONISATION DU C≈íUR (5/5)</p>
        <button id="entry-heart" class="pulse-btn" onclick="heartStep()">‚ù§Ô∏è</button>
    </div>

    <div id="main-app" style="display:none">
        <header>
            <div id="real-clock" class="clock">00:00</div>
            <div id="countdown" class="countdown">PORTAIL ACTIF</div>
            <div class="xp-container"><div id="xp-fill"></div></div>
        </header>

        <div class="container">
            <div class="main-grid">
                <div class="card">
                    <div style="display:flex; justify-content:space-between; margin-bottom:25px;">
                        <div>
                            <h3 style="margin:0;">Jardin de Cristal üíé</h3>
                            <p style="font-size:0.7rem; opacity:0.5;">Laissez une trace visuelle.</p>
                        </div>
                        <button class="tool-btn" style="border-color:rgba(255,0,0,0.2)" onclick="clearAll()">RESET</button>
                    </div>
                    <div id="garden-grid"></div>
                    <div class="tool-bar">
                        <button id="btn-draw" class="tool-btn active" onclick="setTool('draw')">PINCEAU</button>
                        <button id="btn-erase" class="tool-btn" onclick="setTool('erase')">GOMME</button>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom:20px;">√âtat du Portail ‚ö°</h3>
                    <div class="game-box">
                        <div class="player-row"><span class="badge" style="color:var(--accent)">RAYAN</span><div id="moods-R"><span class="mood-btn" onclick="pushMood('rayan','üòä')">üòä</span><span class="mood-btn" onclick="pushMood('rayan','üî•')">üî•</span><span class="mood-btn" onclick="pushMood('rayan','ü•∫')">ü•∫</span><span class="mood-btn" onclick="pushMood('rayan','ü•∞')">ü•∞</span></div></div>
                        <div class="player-row" style="margin:0"><span class="badge" style="color:var(--pink)">ISRAH</span><div id="moods-I"><span class="mood-btn" onclick="pushMood('israh','üòä')">üòä</span><span class="mood-btn" onclick="pushMood('israh','üî•')">üî•</span><span class="mood-btn" onclick="pushMood('israh','ü•∫')">ü•∫</span><span class="mood-btn" onclick="pushMood('israh','ü•∞')">ü•∞</span></div></div>
                    </div>

                    <div class="game-box" style="text-align:center;">
                        <div style="font-size:0.6rem; letter-spacing:2px; opacity:0.5; margin-bottom:15px;">CHIFOUMI / MORPION</div>
                        <div style="display:flex; justify-content:center; gap:20px; margin-bottom:15px;">
                            <span style="cursor:pointer; font-size:1.8rem;" onclick="playRPS('ü™®')">ü™®</span>
                            <span style="cursor:pointer; font-size:1.8rem;" onclick="playRPS('üìú')">üìú</span>
                            <span style="cursor:pointer; font-size:1.8rem;" onclick="playRPS('‚úÇÔ∏è')">‚úÇÔ∏è</span>
                        </div>
                        <div id="rps-res" style="font-size:0.7rem; color:var(--pink); font-weight:800; margin-bottom:20px;">En attente...</div>
                        <div class="ttt-grid" id="ttt-grid"></div>
                        <button onclick="resetGames()" style="background:none; border:none; color:var(--text-dim); font-size:0.6rem; cursor:pointer; margin-top:10px;">R√âINITIALISER JEUX</button>
                    </div>
                </div>
            </div>

            <div class="journals-grid">
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <h3>Journal de Rayan</h3>
                        <div id="dotR" class="status-dot"></div>
                    </div>
                    <div class="q-box">
                        <div style="display:flex; justify-content:space-between;">
                            <span style="font-size:0.6rem; font-weight:800; color:var(--accent);">L'√ÇME R√âPOND</span>
                            <button onclick="rollQ()" style="background:none; border:none; cursor:pointer;">üé≤</button>
                        </div>
                        <p id="q-txt-R" style="margin:10px 0; font-weight:600; color:var(--pink);">...</p>
                        <textarea id="rQ" placeholder="Ta r√©ponse..."></textarea>
                    </div>
                    <textarea id="r1" placeholder="Aujourd‚Äôhui j‚Äôai gard√© pour moi‚Ä¶"></textarea>
                    <textarea id="r2" placeholder="J‚Äôai √©t√© fier de‚Ä¶"></textarea>
                    <textarea id="r3" placeholder="J‚Äôaurais aim√© te dire‚Ä¶"></textarea>
                    <textarea id="r4" placeholder="Quelque chose m'a bless√©‚Ä¶"></textarea>
                    <textarea id="r5" placeholder="J‚Äôai manqu√© de‚Ä¶"></textarea>
                    <button class="finish-btn" onclick="seal('Rayan')">SCELLER POUR ISRAH üñ§</button>
                </div>

                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <h3>Journal d'Israh</h3>
                        <div id="dotI" class="status-dot"></div>
                    </div>
                    <div class="q-box">
                        <span style="font-size:0.6rem; font-weight:800; color:var(--accent);">L'√ÇME R√âPOND</span>
                        <p id="q-txt-I" style="margin:10px 0; font-weight:600; color:var(--pink);">...</p>
                        <textarea id="iQ" placeholder="Ta r√©ponse..."></textarea>
                    </div>
                    <textarea id="i1" placeholder="Aujourd‚Äôhui j‚Äôai gard√© pour moi‚Ä¶"></textarea>
                    <textarea id="i2" placeholder="J‚Äôai √©t√© fi√®re de‚Ä¶"></textarea>
                    <textarea id="i3" placeholder="J‚Äôaurais aim√© te dire‚Ä¶"></textarea>
                    <textarea id="i4" placeholder="Quelque chose m'a bless√©e‚Ä¶"></textarea>
                    <textarea id="i5" placeholder="J‚Äôai manqu√© de‚Ä¶"></textarea>
                    <button class="finish-btn" style="background:var(--pink)" onclick="seal('Israh')">SCELLER POUR RAYAN üñ§</button>
                </div>
            </div>

            <div class="card" style="border: 1px solid rgba(255,68,68,0.2);">
                <div style="text-align: center; margin-bottom: 25px;">
                    <div id="status-badge" class="pulse-red" style="background: var(--red); color: #fff; display: inline-block; padding: 5px 15px; border-radius: 5px; font-size: 0.6rem; font-weight: 800; letter-spacing: 2px; margin-bottom: 15px;">V√âRIT√â SYNCHRONIS√âE üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
                </div>

                <div style="background: rgba(0,0,0,0.3); border: 1px solid rgba(255,68,68,0.3); border-radius: 30px; padding: 40px; position: relative; text-align: center;">
                    <div id="radar" style="position: absolute; top: 15px; right: 15px; width: 25px; height: 25px; border: 1px solid rgba(255,68,68,0.3); border-radius: 50%;">
                        <div style="width: 100%; height: 100%; border-radius: 50%; border-top: 2px solid var(--red); animation: interro-spin 2s linear infinite;"></div>
                    </div>
                    <p id="interro-display" style="font-family: monospace; color: var(--red); font-size: 1rem; text-transform: uppercase;">PR√äT POUR L'INTERROGATOIRE...</p>
                    
                    <div style="margin-top: 30px;">
                        <div style="display:flex; justify-content:space-between; font-size:0.6rem; color:var(--red); margin-bottom:5px;"><span>STRESS LEVEL</span><span id="stress-val">0%</span></div>
                        <div style="height:6px; background:rgba(255,255,255,0.05); border-radius:10px; overflow:hidden;">
                            <div id="stress-bar" style="width:0%; height:100%; background:var(--red); box-shadow:0 0 15px var(--red); transition:0.4s;"></div>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px;">
                    <button class="finish-btn" style="background:#1a0b2e; border:1px solid var(--red); grid-column:span 2;" onclick="assignRoles()">üé≠ D√âSIGNER LES R√îLES</button>
                    <button class="finish-btn" style="background:var(--red);" onclick="pullQuestion()">üìÇ DOSSIER SUIVANT</button>
                    <button class="finish-btn" style="background:var(--green);" onclick="addStress(-15)">‚úÖ V√âRIT√â</button>
                    <button class="finish-btn" style="background:var(--orange); grid-column:span 2;" onclick="addStress(20)">‚ùå MENSONGE / H√âSITATION</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal">
        <div class="modal-content">
            <h2 id="modal-title">C≈ìur Scell√© ! ‚ú®</h2>
            <p id="modal-msg">Tes r√©ponses ont √©t√© envoy√©es au serveur crypt√©.</p>
            <button class="who-btn" style="width:100%; margin:0;" onclick="document.getElementById('modal').style.display='none'">FERMER</button>
        </div>
    </div>

<script>
    let myUser = "";
    let clicks = 0;
    let tool = "draw";
    const soulQuestions = ["Ton moment pr√©f√©r√© ?", "Une chose que tu aimes chez moi ?", "Un d√©fi ?", "Quelle √©motion ?", "Ta fiert√© ?", "Un souvenir ?"];
    const ciaQuestions = ["AGENT : Premier d√©tail physique remarqu√© ?", "AGENT : Cacher un secret 1 an pour 1M‚Ç¨ ?", "AGENT : Habitude bizarre seul(e) ?", "AGENT : Faire semblant de dormir ?", "AGENT : Chose la plus folle par amour ?", "AGENT : Un trait √† changer chez moi ?", "AGENT : Dernier r√™ve avec moi ?", "AGENT : Complice ou d√©nonciateur ?", "AGENT : Quel habit je devrais jeter ?", "AGENT : Pire question possible ?", "AGENT : Lire mes pens√©es 30s ?", "AGENT : Moment de jalousie inavou√© ?"];

    function identify(u) {
        myUser = u;
        document.getElementById('who-screen').classList.add('hidden');
        setTimeout(() => {
            document.getElementById('intro-screen').classList.remove('hidden');
            document.getElementById('welcome-txt').innerText = "Bonjour " + u;
        }, 600);
    }

    function heartStep() {
        clicks++;
        const h = document.getElementById('entry-heart');
        h.style.transform = `scale(${1 + clicks*0.15})`;
        document.getElementById('step-txt').innerText = `SYNCHRONISATION (${5-clicks}/5)`;
        if(clicks >= 5) {
            document.getElementById('intro-screen').classList.add('hidden');
            setTimeout(() => {
                document.getElementById('main-app').style.display = 'block';
                window.scrollTo(0,0);
            }, 800);
        }
    }

    // Logic Jardin
    const gGrid = document.getElementById('garden-grid');
    for(let i=0; i<144; i++) {
        const p = document.createElement('div'); p.className = 'pixel';
        p.onclick = () => {
            const color = tool === 'draw' ? (myUser === 'Rayan' ? 'var(--accent)' : 'var(--pink)') : 'rgba(255,255,255,0.04)';
            database.ref('harmonie_v3/garden/'+i).set(color);
        };
        gGrid.appendChild(p);
    }
    function setTool(t) {
        tool = t;
        document.getElementById('btn-draw').classList.toggle('active', t==='draw');
        document.getElementById('btn-erase').classList.toggle('active', t==='erase');
    }
    function clearAll() { database.ref('harmonie_v3/garden').remove(); }

    // Logic Morpion
    const tGrid = document.getElementById('ttt-grid');
    for(let i=0; i<9; i++) {
        const c = document.createElement('div'); c.className = 'ttt-cell';
        c.onclick = () => database.ref('harmonie_v3/ttt/'+i).set(myUser === 'Rayan' ? 'X' : 'O');
        tGrid.appendChild(c);
    }

    // Interrogatoire
    function assignRoles() {
        const agent = Math.random() > 0.5 ? 'Rayan' : 'Israh';
        const suspect = agent === 'Rayan' ? 'Israh' : 'Rayan';
        database.ref('harmonie_v3/interro').update({ display: `L'AGENT ${agent.toUpperCase()} INTERROGE ${suspect.toUpperCase()}.`, stress: 0 });
    }
    function pullQuestion() {
        const q = ciaQuestions[Math.floor(Math.random() * ciaQuestions.length)];
        database.ref('harmonie_v3/interro').update({ display: q });
    }
    function addStress(amount) {
        database.ref('harmonie_v3/interro/stress').transaction(c => Math.min(Math.max((c||0)+amount,0),100));
    }

    // Firebase Sync
    database.ref('harmonie_v3').on('value', snap => {
        const d = snap.val() || {};
        // Sync Garden
        document.querySelectorAll('.pixel').forEach((p, i) => {
            const c = d.garden?.[i] || 'rgba(255,255,255,0.04)';
            p.style.background = c;
            p.style.boxShadow = c.includes('var') ? `0 0 10px ${c.replace('var(','').replace(')','')}` : 'none';
        });
        // Sync Interro
        const interro = d.interro || {};
        document.getElementById('interro-display').innerText = interro.display || "SYST√àME PR√äT";
        const s = interro.stress || 0;
        document.getElementById('stress-bar').style.width = s + "%";
        document.getElementById('stress-val').innerText = s + "%";
        // Sync Games
        document.querySelectorAll('.ttt-cell').forEach((c, i) => {
            const v = d.ttt?.[i] || "";
            c.innerText = v;
            c.style.color = v === 'X' ? 'var(--accent)' : 'var(--pink)';
        });
        const rps = d.rps || {};
        document.getElementById('rps-res').innerText = (rps.rayan && rps.israh) ? `R: ${rps.rayan} | I: ${rps.israh}` : "Choix en cours...";
        // Sync Moods & Journals
        document.getElementById('q-txt-R').innerText = document.getElementById('q-txt-I').innerText = d.qSoul || "üé≤ ?";
        document.getElementById('dotR').classList.toggle('active', d.done?.Rayan);
        document.getElementById('dotI').classList.toggle('active', d.done?.Israh);
        for(let i=1; i<=5; i++) {
            if(document.activeElement.id !== 'r'+i) document.getElementById('r'+i).value = d.valR?.[i-1] || "";
            if(document.activeElement.id !== 'i'+i) document.getElementById('i'+i).value = d.valI?.[i-1] || "";
        }
    });

    function pushMood(u, m) { database.ref('harmonie_v3/moods/'+u).set(m); }
    function playRPS(m) { database.ref(`harmonie_v3/rps/${myUser.toLowerCase()}`).set(m); }
    function rollQ() { database.ref('harmonie_v3/qSoul').set(soulQuestions[Math.floor(Math.random()*soulQuestions.length)]); }
    function resetGames() { database.ref('harmonie_v3/ttt').remove(); database.ref('harmonie_v3/rps').remove(); }

    function syncText() {
        const vr = [1,2,3,4,5].map(n => document.getElementById('r'+n).value);
        const vi = [1,2,3,4,5].map(n => document.getElementById('i'+n).value);
        database.ref('harmonie_v3').update({ valR: vr, valI: vi });
    }
    document.querySelectorAll('textarea').forEach(t => t.oninput = syncText);

    function seal(u) {
        database.ref('harmonie_v3/done/'+u).set(true);
        confetti({ particleCount: 150, colors: ['#9b5de5', '#f178ff'] });
        document.getElementById('modal').style.display = 'flex';
    }

    setInterval(() => {
        const now = new Date();
        document.getElementById('real-clock').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }, 1000);
</script>
</body>
</html> 
