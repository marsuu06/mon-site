<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'Harmonie ðŸŒ™</title>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBPNfMyhIOTWyGG-ZB5pOTr-y3TA0J3B28",
            authDomain: "mon-projet062.firebaseapp.com",
            databaseURL: "https://mon-projet062-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mon-projet062",
            storageBucket: "mon-projet062.appspot.com",
            messagingSenderId: "1054174163421",
            appId: "1:1054174163421:web:50817b3c930a5eb55ac634"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');

        :root {
            --accent: #9b5de5;
            --accent-light: #f178ff;
            --bg: #0d0617;
            --card-bg: rgba(255, 255, 255, 0.05);
        }

        body, html {
            margin: 0; padding: 0; min-height: 100vh;
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            color: #fff; overflow-x: hidden;
        }

        /* --- FOND ANIME --- */
        .nebula {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, #2d1b4e 0%, #0d0617 100%);
            z-index: -1;
        }
        .nebula::after {
            content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: transparent url('https://www.transparenttextures.com/patterns/stardust.png') repeat;
            animation: move-stars 100s linear infinite; opacity: 0.3;
        }
        @keyframes move-stars { from { transform: translate(0,0); } to { transform: translate(100px, 100px); } }

        /* --- ECRAN D'ENTRÃ‰E --- */
        #intro-screen {
            position: fixed; inset: 0; z-index: 2000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg); padding: 20px; text-align: center;
            transition: all 1s cubic-bezier(0.645, 0.045, 0.355, 1);
        }
        
        #intro-screen.fade-out {
            opacity: 0; pointer-events: none; transform: scale(1.5) rotate(2deg); filter: blur(20px);
        }

        .welcome-title {
            font-size: clamp(2.5rem, 8vw, 4rem); font-weight: 800;
            background: linear-gradient(to right, #fff, var(--accent-light));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 10px; animation: pulseGlow 3s infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(155, 93, 229, 0)); }
            50% { filter: drop-shadow(0 0 20px rgba(155, 93, 229, 0.5)); }
        }

        .rules-card {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
            padding: 25px; border-radius: 20px; max-width: 400px; margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .neon-btn {
            background: var(--accent); color: white; border: none;
            padding: 18px 50px; border-radius: 50px; font-weight: 700;
            font-size: 1.1rem; cursor: pointer; transition: 0.4s;
            box-shadow: 0 10px 30px rgba(155, 93, 229, 0.4);
        }
        .neon-btn:hover { transform: translateY(-5px); box-shadow: 0 15px 40px var(--accent); }

        /* --- HEADER & RITUEL --- */
        #main-content { opacity: 0; transition: 1.5s; }
        #main-content.visible { opacity: 1; }

        header { padding: 40px 20px 20px; text-align: center; }
        
        .xp-container { 
            width: clamp(200px, 50%, 400px); height: 8px; 
            background: rgba(255,255,255,0.1); border-radius: 10px; 
            margin: 20px auto; overflow: hidden; border: 1px solid rgba(255,255,255,0.05);
        }
        #xp-fill { width: 0%; height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent-light)); transition: 1.2s ease; }

        .main-container {
            max-width: 1200px; margin: auto; padding: 20px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px;
        }

        .card {
            background: var(--card-bg); backdrop-filter: blur(20px);
            border-radius: 35px; padding: 30px; border: 1px solid rgba(255,255,255,0.08);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .card:hover { transform: translateY(-10px); border-color: var(--accent); }

        textarea {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 18px; color: #fff; padding: 15px; margin-bottom: 12px;
            font-family: inherit; resize: none; box-sizing: border-box; transition: 0.3s;
        }
        textarea:focus { border-color: var(--accent-light); background: rgba(0,0,0,0.5); outline: none; }

        .status-dot { width: 12px; height: 12px; background: #333; border-radius: 50%; display: inline-block; margin-left: 10px; }
        .status-dot.active { background: #00ff88; box-shadow: 0 0 15px #00ff88; animation: pulse 2s infinite; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .finish-btn {
            width: 100%; padding: 18px; border-radius: 20px; border: none;
            background: linear-gradient(45deg, var(--accent), #7037b3);
            color: white; font-weight: 700; cursor: pointer; transition: 0.3s;
        }

        #timer { font-weight: 600; font-size: 0.9rem; opacity: 0.8; letter-spacing: 1px; }

    </style>
</head>
<body>

    <div class="nebula"></div>

    <div id="intro-screen">
        <div class="animate__animated animate__fadeInDown">
            <h1 class="welcome-title">L'Harmonie</h1>
            <div class="rules-card">
                <p style="margin: 0; line-height: 1.6;">
                    âœ¨ <b>Bienveillance</b> avant tout.<br>
                    âœ¨ <b>HonnÃªtetÃ©</b> sur vos Ã©motions.<br>
                    âœ¨ <b>Ã‰coute</b> du cÅ“ur de l'autre.<br>
                    <small style="display:block; margin-top:15px; opacity:0.6;">Les secrets s'Ã©vaporent Ã  minuit.</small>
                </p>
            </div>
            <button class="neon-btn" onclick="acceptRules()">Entrer dans le Rituel ðŸŒ™</button>
        </div>
    </div>

    <div id="main-content">
        <header>
            <div id="timer">Connexion...</div>
            <div class="xp-container"><div id="xp-fill"></div></div>
        </header>

        <div class="main-container">
            <div class="card animate__animated animate__fadeInLeft">
                <h2 style="margin:0">Rayan <div id="dotRayan" class="status-dot"></div></h2>
                <div style="background:rgba(155, 93, 229, 0.1); padding:15px; border-radius:20px; margin:20px 0;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-size:0.7rem; opacity:0.5; text-transform:uppercase;">Question du jour</span>
                        <button onclick="newQuestion()" style="background:none; border:none; cursor:pointer;">ðŸŽ²</button>
                    </div>
                    <p id="displayQ" style="margin:10px 0; color:var(--accent-light); font-weight:600;">...</p>
                    <textarea id="rQ" placeholder="Ta rÃ©ponse..."></textarea>
                </div>
                <textarea id="r1" placeholder="Aujourdâ€™hui jâ€™ai gardÃ© pour moiâ€¦"></textarea>
                <textarea id="r2" placeholder="Aujourdâ€™hui jâ€™ai Ã©tÃ© fier(e) deâ€¦"></textarea>
                <textarea id="r3" placeholder="Aujourdâ€™hui jâ€™aurais aimÃ© te direâ€¦"></textarea>
                <textarea id="r4" placeholder="Un truc qui mâ€™a saoulÃ© / blessÃ©â€¦"></textarea>
                <textarea id="r5" placeholder="Aujourdâ€™hui jâ€™ai manquÃ© deâ€¦"></textarea>
                <button class="finish-btn" onclick="complete('Rayan')">J'ai terminÃ© ðŸ–¤</button>
            </div>

            <div class="card animate__animated animate__fadeInRight">
                <h2 style="margin:0">Israh <div id="dotIsrah" class="status-dot"></div></h2>
                <div style="background:rgba(155, 93, 229, 0.1); padding:15px; border-radius:20px; margin:20px 0;">
                    <span style="font-size:0.7rem; opacity:0.5; text-transform:uppercase;">Question du jour</span>
                    <p id="displayQIsrah" style="margin:10px 0; color:var(--accent-light); font-weight:600;">...</p>
                    <textarea id="iQ" placeholder="Ta rÃ©ponse..."></textarea>
                </div>
                <textarea id="i1" placeholder="Aujourdâ€™hui jâ€™ai gardÃ© pour moiâ€¦"></textarea>
                <textarea id="i2" placeholder="Aujourdâ€™hui jâ€™ai Ã©tÃ© fier(e) deâ€¦"></textarea>
                <textarea id="i3" placeholder="Aujourdâ€™hui jâ€™aurais aimÃ© te direâ€¦"></textarea>
                <textarea id="i4" placeholder="Un truc qui mâ€™a saoulÃ© / blessÃ©â€¦"></textarea>
                <textarea id="i5" placeholder="Aujourdâ€™hui jâ€™ai manquÃ© deâ€¦"></textarea>
                <button class="finish-btn" style="background:linear-gradient(45deg, #f178ff, #9b5de5);" onclick="complete('Israh')">J'ai terminÃ© ðŸ–¤</button>
            </div>
        </div>
    </div>

<script>
    const questions = ["Le moment le plus drÃ´le ? ðŸ˜‚", "Si ta journÃ©e Ã©tait un film ? ðŸŽ¬", "3 mots absurdes ? ðŸ˜œ", "Un dÃ©tail nul mais marrant ? ðŸ¤ª", "Un truc aimÃ© chez lâ€™autre ? ðŸ’–", "Si ta journÃ©e Ã©tait un animal ? ðŸ¶", "Un moment de fiertÃ© ? ðŸ’ª", "Un dÃ©fi ridicule rÃ©ussi ? ðŸ˜", "Un sourire pour rien ? ðŸ˜„", "1 moment Ã  rejouer ? âœ¨"];

    let finishedStatus = { Rayan: false, Israh: false };

    function acceptRules() {
        document.getElementById('intro-screen').classList.add('fade-out');
        document.getElementById('main-content').classList.add('visible');
        setTimeout(() => document.getElementById('intro-screen').style.display = 'none', 1000);
    }

    window.onload = () => {
        database.ref('rituel_final').on('value', (snapshot) => {
            const data = snapshot.val();
            if(data) {
                if(data.rayan) {
                    for(let i=1;i<=5;i++) if(document.activeElement !== document.getElementById('r'+i)) document.getElementById('r'+i).value = data.rayan[i-1] || "";
                    if(document.activeElement !== document.getElementById('rQ')) document.getElementById('rQ').value = data.rayan[5] || "";
                }
                if(data.israh) {
                    for(let i=1;i<=5;i++) if(document.activeElement !== document.getElementById('i'+i)) document.getElementById('i'+i).value = data.israh[i-1] || "";
                    if(document.activeElement !== document.getElementById('iQ')) document.getElementById('iQ').value = data.israh[5] || "";
                }
                document.getElementById('displayQ').innerText = data.question || "...";
                document.getElementById('displayQIsrah').innerText = data.question || "...";
                finishedStatus = data.finished || {Rayan:false, Israh:false};
                if(finishedStatus.Rayan) document.getElementById('dotRayan').classList.add('active');
                if(finishedStatus.Israh) document.getElementById('dotIsrah').classList.add('active');
                updateXP();
            }
        });
    };

    function newQuestion() {
        const q = questions[Math.floor(Math.random()*questions.length)];
        database.ref('rituel_final/question').set(q);
    }

    function save() {
        const data = {
            rayan: [document.getElementById('r1').value, document.getElementById('r2').value, document.getElementById('r3').value, document.getElementById('r4').value, document.getElementById('r5').value, document.getElementById('rQ').value],
            israh: [document.getElementById('i1').value, document.getElementById('i2').value, document.getElementById('i3').value, document.getElementById('i4').value, document.getElementById('i5').value, document.getElementById('iQ').value],
            question: document.getElementById('displayQ').innerText,
            finished: finishedStatus
        };
        database.ref('rituel_final').update(data);
        updateXP();
    }

    function complete(user) {
        finishedStatus[user] = true;
        save();
        if(finishedStatus.Rayan && finishedStatus.Israh) {
            confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 }, colors: ['#9b5de5', '#f178ff'] });
        }
    }

    function updateXP() {
        const t = document.querySelectorAll('textarea');
        let filled = 0;
        t.forEach(el => { if(el.value.length > 2) filled++ });
        document.getElementById('xp-fill').style.width = (filled / t.length) * 100 + "%";
    }

    document.querySelectorAll('textarea').forEach(t => t.addEventListener('input', save));

    setInterval(() => {
        const now = new Date();
        const diff = new Date().setHours(24,0,0,0) - now;
        const h = Math.floor(diff/3600000);
        const m = Math.floor((diff%3600000)/60000);
        const s = Math.floor((diff%60000)/1000);
        document.getElementById('timer').innerText = `ðŸŒ™ Fermeture dans ${h}h ${m}m ${s}s`;
    }, 1000);
</script>
</body>
</html>
