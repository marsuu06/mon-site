<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>L'Harmonie ðŸŒ™</title>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBPNfMyhIOTWyGG-ZB5pOTr-y3TA0J3B28",
            authDomain: "mon-projet062.firebaseapp.com",
            databaseURL: "https://mon-projet062-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mon-projet062",
            storageBucket: "mon-projet062.appspot.com",
            messagingSenderId: "1054174163421",
            appId: "1:1054174163421:web:50817b3c930a5eb55ac634"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');

        :root {
            --accent: #9b5de5;
            --purple-dark: #1a0b2e;
            --bg: #090511;
            --glass: rgba(255, 255, 255, 0.05);
            --pink: #f178ff;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0; background: var(--bg); color: #fff;
            background: radial-gradient(circle at top, var(--purple-dark), var(--bg));
            min-height: 100vh; overflow-x: hidden;
        }

        /* --- Accueil --- */
        #intro-screen {
            position: fixed; inset: 0; z-index: 1000;
            background: var(--bg); display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center;
            padding: 20px; transition: 0.8s ease;
        }
        #intro-screen.hidden { opacity: 0; pointer-events: none; transform: scale(1.1); }

        .welcome-title {
            font-size: 3rem; font-weight: 800; margin-bottom: 10px;
            background: linear-gradient(to right, #fff, var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* --- Layout --- */
        #main-app { display: none; opacity: 0; transition: 1s; padding: 20px; max-width: 1000px; margin: auto; }
        #main-app.visible { display: block; opacity: 1; }

        .section-title { font-size: 1.2rem; text-transform: uppercase; letter-spacing: 2px; color: var(--accent); margin: 40px 0 20px; text-align: center; font-weight: 700; }

        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }

        .card {
            background: var(--glass); border-radius: 25px; padding: 25px;
            border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* --- Mood Matcher --- */
        .mood-row { display: flex; justify-content: space-around; margin-top: 10px; }
        .mood-emoji { font-size: 1.8rem; cursor: pointer; transition: 0.3s; opacity: 0.3; filter: grayscale(1); }
        .mood-emoji.active { opacity: 1; filter: grayscale(0); transform: scale(1.2); }

        /* --- Jardin (Pixel Art) --- */
        #pixel-canvas { display: grid; grid-template-columns: repeat(8, 1fr); gap: 4px; max-width: 280px; margin: 0 auto; }
        .pixel { aspect-ratio: 1; background: rgba(255,255,255,0.1); border-radius: 4px; cursor: pointer; }

        /* --- Enigme CoopÃ©ration --- */
        .code-group { display: flex; justify-content: center; gap: 10px; }
        .code-input { width: 50px; height: 60px; background: rgba(0,0,0,0.3); border: 2px solid var(--glass); border-radius: 12px; text-align: center; color: #fff; font-size: 1.5rem; font-weight: 700; }
        .code-input:focus { border-color: var(--accent); outline: none; }

        /* --- Journal & UI --- */
        textarea { width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--glass); border-radius: 15px; color: #fff; padding: 12px; font-family: inherit; resize: none; box-sizing: border-box; margin-bottom: 8px; }
        .finish-btn { width: 100%; padding: 15px; border-radius: 15px; border: none; background: linear-gradient(45deg, var(--accent), var(--pink)); color: white; font-weight: 700; cursor: pointer; margin-top: 10px; }
        .dot { width: 10px; height: 10px; background: #333; border-radius: 50%; display: inline-block; margin-left: 10px; }
        .dot.active { background: #00ff88; box-shadow: 0 0 10px #00ff88; }

        /* --- Secret Tap Button --- */
        #secret-tap { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; border: none; box-shadow: 0 0 20px var(--accent); z-index: 100; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        @media (max-width: 600px) { .welcome-title { font-size: 2.2rem; } }
    </style>
</head>
<body>

    <div id="intro-screen">
        <h1 class="welcome-title">L'Harmonie</h1>
        <p style="opacity: 0.6;">Appuyez pour synchroniser vos Ã¢mes...</p>
        <button class="finish-btn" style="width: 200px;" onclick="enterApp()">Entrer ðŸŒ™</button>
    </div>

    <div id="main-app">
        <header style="text-align: center; margin-bottom: 30px;">
            <div id="timer" style="font-weight: 600; color: var(--accent);">Chargement de l'univers...</div>
        </header>

        <div class="section-title">Connexion InstantanÃ©e</div>
        <div class="grid-container">
            <div class="card">
                <h3 style="margin: 0 0 15px 0;">MÃ©tÃ©o du CÅ“ur</h3>
                <p class="label" style="font-size: 0.7rem; opacity: 0.5;">RAYAN</p>
                <div class="mood-row" id="mood-rayan">
                    <span class="mood-emoji" onclick="setMood('rayan', 'ðŸ˜Š')">ðŸ˜Š</span>
                    <span class="mood-emoji" onclick="setMood('rayan', 'ðŸ˜´')">ðŸ˜´</span>
                    <span class="mood-emoji" onclick="setMood('rayan', 'ðŸ”¥')">ðŸ”¥</span>
                    <span class="mood-emoji" onclick="setMood('rayan', 'ðŸ¥º')">ðŸ¥º</span>
                </div>
                <p class="label" style="font-size: 0.7rem; opacity: 0.5; margin-top: 15px;">ISRAH</p>
                <div class="mood-row" id="mood-israh">
                    <span class="mood-emoji" onclick="setMood('israh', 'ðŸ˜Š')">ðŸ˜Š</span>
                    <span class="mood-emoji" onclick="setMood('israh', 'ðŸ˜´')">ðŸ˜´</span>
                    <span class="mood-emoji" onclick="setMood('israh', 'ðŸ”¥')">ðŸ”¥</span>
                    <span class="mood-emoji" onclick="setMood('israh', 'ðŸ¥º')">ðŸ¥º</span>
                </div>
            </div>

            <div class="card">
                <h3 style="margin: 0 0 10px 0;">Le Code de l'UnitÃ©</h3>
                <p style="font-size: 0.8rem; opacity: 0.7; margin-bottom: 15px;">Rayan (Chiffres 1&2) | Israh (3&4)</p>
                <div class="code-group">
                    <input type="text" maxlength="1" id="c1" class="code-input" placeholder="?">
                    <input type="text" maxlength="1" id="c2" class="code-input" placeholder="?">
                    <input type="text" maxlength="1" id="c3" class="code-input" placeholder="?">
                    <input type="text" maxlength="1" id="c4" class="code-input" placeholder="?">
                </div>
                <p id="code-msg" style="text-align: center; margin-top: 15px; font-weight: 700; color: var(--pink); min-height: 20px;"></p>
            </div>
        </div>

        <div class="section-title">Les Murmures du Soir</div>
        <div class="grid-container">
            <div class="card">
                <h3>Rayan <div id="dotRayan" class="dot"></div></h3>
                <textarea id="rQ" placeholder="Question de l'Ã¢me..." style="border-left: 3px solid var(--accent);"></textarea>
                <textarea id="r1" placeholder="Ce que j'ai gardÃ© pour moi..."></textarea>
                <textarea id="r2" placeholder="Fier de..."></textarea>
                <button class="finish-btn" onclick="complete('Rayan')">Sceller mon journal</button>
            </div>
            <div class="card">
                <h3>Israh <div id="dotIsrah" class="dot"></div></h3>
                <textarea id="iQ" placeholder="Question de l'Ã¢me..." style="border-left: 3px solid var(--pink);"></textarea>
                <textarea id="i1" placeholder="Ce que j'ai gardÃ© pour moi..."></textarea>
                <textarea id="i2" placeholder="FiÃ¨re de..."></textarea>
                <button class="finish-btn" style="background: var(--pink);" onclick="complete('Israh')">Sceller mon journal</button>
            </div>
        </div>

        <div class="section-title">Le Jardin des Pixels</div>
        <div class="card" style="max-width: 400px; margin: 0 auto 50px auto;">
            <div id="pixel-canvas"></div>
            <button onclick="clearJardin()" style="background: none; border: none; color: gray; width: 100%; margin-top: 15px; cursor: pointer; font-size: 0.8rem;">RÃ©initialiser le jardin</button>
        </div>
    </div>

    <button id="secret-tap" onclick="sendLove()">ðŸ’–</button>

<script>
    // --- Logique Application ---
    function enterApp() {
        document.getElementById('intro-screen').classList.add('hidden');
        document.getElementById('main-app').style.display = 'block';
        setTimeout(() => document.getElementById('main-app').classList.add('visible'), 50);
    }

    // --- Mood Matcher ---
    function setMood(user, emoji) {
        database.ref('harmonie/moods/' + user).set(emoji);
    }

    // --- Secret Tap ---
    function sendLove() {
        database.ref('harmonie/love_tap').set(Date.now());
    }

    // --- Enigme Coop ---
    const inputs = [document.getElementById('c1'), document.getElementById('c2'), document.getElementById('c3'), document.getElementById('c4')];
    inputs.forEach((input, i) => {
        input.addEventListener('input', () => {
            database.ref('harmonie/code/' + i).set(input.value);
            if (input.value && i < 3) inputs[i+1].focus();
        });
    });

    // --- Le Jardin (Pixel Art) ---
    const canvas = document.getElementById('pixel-canvas');
    for (let i = 0; i < 64; i++) {
        const p = document.createElement('div');
        p.className = 'pixel';
        p.onclick = () => {
            const currentColor = p.style.background;
            const newColor = (currentColor.includes('rgba(255, 255, 255, 0.1)') || currentColor === "") ? '#9b5de5' : 'rgba(255, 255, 255, 0.1)';
            database.ref('harmonie/pixels/' + i).set(newColor);
        };
        canvas.appendChild(p);
    }

    function clearJardin() { database.ref('harmonie/pixels').remove(); }

    // --- Firebase Sync ---
    database.ref('harmonie').on('value', (snap) => {
        const data = snap.val() || {};
        
        // Moods
        if (data.moods) {
            ['rayan', 'israh'].forEach(user => {
                document.querySelectorAll(`#mood-${user} .mood-emoji`).forEach(el => {
                    el.classList.toggle('active', el.innerText === data.moods[user]);
                });
            });
        }

        // Code Enigme (Le code secret est 0602 par exemple)
        if (data.code) {
            data.code.forEach((val, i) => { if(document.activeElement !== inputs[i]) inputs[i].value = val || ""; });
            if (data.code.join('') === "0602") { // <--- CHANGE LE CODE ICI
                document.getElementById('code-msg').innerText = "âœ¨ Porte ouverte : Je t'aime âœ¨";
            }
        }

        // Love Tap
        if (data.love_tap) {
            confetti({ particleCount: 40, spread: 70, origin: { y: 0.8 }, colors: ['#9b5de5', '#f178ff'] });
        }

        // Pixels
        const pixels = document.querySelectorAll('.pixel');
        pixels.forEach((p, i) => {
            p.style.background = (data.pixels && data.pixels[i]) ? data.pixels[i] : 'rgba(255, 255, 255, 0.1)';
        });

        // Journal status
        if(data.finished?.Rayan) document.getElementById('dotRayan').classList.add('active');
        if(data.finished?.Israh) document.getElementById('dotIsrah').classList.add('active');
    });

    // Journal Logic
    function complete(user) {
        database.ref('harmonie/finished/' + user).set(true);
        confetti({ particleCount: 100, spread: 70 });
    }

    // Timer
    setInterval(() => {
        const now = new Date();
        const diff = new Date().setHours(24,0,0,0) - now;
        const h = Math.floor(diff/3600000);
        const m = Math.floor((diff%3600000)/60000);
        document.getElementById('timer').innerText = `L'espace se referme dans ${h}h ${m}m`;
    }, 1000);
</script>
</body>
</html>
