<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>L'Harmonie üåô Version Premium</title>
    
    <!-- LIENS Firebase et Confetti -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <!-- Polices Google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* TOUT LE CSS QUE JE VOUS AI D√âJ√Ä DONN√â */
        /* (Gardez exactement le m√™me CSS que pr√©c√©demment) */
        :root {
            --bg-primary: #0a0614;
            --bg-secondary: #131023;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --accent-purple: #9b5de5;
            --accent-pink: #f15bb5;
            --accent-blue: #00bbf9;
            --accent-green: #00f5d4;
            --accent-yellow: #fee440;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.4);
            --shadow-glow: 0 0 30px rgba(155, 93, 229, 0.2);
            --gradient-purple-pink: linear-gradient(135deg, #9b5de5 0%, #f15bb5 100%);
            --gradient-blue-green: linear-gradient(135deg, #00bbf9 0%, #00f5d4 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(155, 93, 229, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(241, 91, 181, 0.1) 0%, transparent 50%);
        }

        /* TOUT LE RESTE DU CSS RESTE IDENTIQUE */
        /* ... (collez ici tout le CSS pr√©c√©dent) ... */

    </style>
</head>
<body>

    <!-- M√äME HTML QUE PR√âC√âDEMMENT -->
    <!-- √âCRAN D'AUTHENTIFICATION -->
    <div id="auth-screen">
        <div class="logo-container">
            <div class="logo">üåô</div>
            <h1 class="title">L'HARMONIE</h1>
            <p class="subtitle">VERSION PREMIUM</p>
        </div>
        
        <p style="max-width: 500px; text-align: center; margin-bottom: 30px; line-height: 1.6; color: var(--text-secondary);">
            Un espace sacr√© o√π deux √¢mes synchronisent leurs √©nergies.<br>
            Connectez-vous pour acc√©der √† votre jardin num√©rique.
        </p>
        
        <div class="user-select">
            <div class="user-btn rayan" onclick="identify('Rayan')">
                <div class="user-icon">üëë</div>
                <div>RAYAN</div>
            </div>
            <div class="user-btn israh" onclick="identify('Israh')">
                <div class="user-icon">üí´</div>
                <div>ISRAH</div>
            </div>
        </div>
        
        <p style="font-size: 0.8rem; color: var(--text-tertiary); margin-top: 30px;">
            S√©lectionnez votre identit√© pour entrer
        </p>
    </div>

    <!-- √âCRAN DE SYNCHRONISATION -->
    <div id="sync-screen">
        <h2 id="welcome-text" style="font-size: 2rem; font-weight: 700; margin-bottom: 10px;">...</h2>
        <p id="sync-instruction" style="font-size: 0.8rem; letter-spacing: 2px; color: var(--text-tertiary); margin-bottom: 30px;">
            CLIQUEZ 5 FOIS POUR SYNCHRONISER
        </p>
        <button id="sync-heart" class="sync-heart" onclick="heartStep()">‚ù§Ô∏è</button>
        <div id="sync-progress" style="margin-top: 20px; font-size: 0.9rem; color: var(--accent-purple);">
            Progression: <span id="sync-count">0</span>/5
        </div>
    </div>

    <!-- APPLICATION PRINCIPALE -->
    <div id="main-app">
        <!-- Indicateur utilisateur -->
        <div id="user-indicator" class="user-indicator"></div>
        <button class="logout-btn" onclick="logout()">üîÑ D√©connexion</button>
        
        <!-- Header -->
        <header class="app-header">
            <div class="header-bg"></div>
            <div id="real-clock" class="real-clock">00:00</div>
            <div id="countdown" class="countdown">Reset dans --h --m</div>
            
            <div class="xp-container">
                <div class="xp-bar">
                    <div id="xp-fill" class="xp-fill"></div>
                </div>
                <div class="xp-info">
                    <span>HARMONIE</span>
                    <span id="xp-percent">0%</span>
                </div>
            </div>
            
            <div class="status-badge">
                <div class="status-dot"></div>
                PORTAIL ACTIF
            </div>
        </header>

        <!-- Contenu principal -->
        <div class="container">
            <!-- Grille principale -->
            <div class="main-grid">
                <!-- Jardin de Cristal -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üíé</div>
                        <div>
                            <h3 class="card-title">Jardin de Cristal</h3>
                            <p class="card-subtitle">Laissez une trace visuelle de votre passage</p>
                        </div>
                    </div>
                    
                    <div id="garden-grid"></div>
                    
                    <div class="tools-bar">
                        <button id="btn-draw" class="tool-btn active" onclick="setTool('draw')">
                            üñåÔ∏è PINCEAU
                        </button>
                        <button id="btn-erase" class="tool-btn" onclick="setTool('erase')">
                            üßΩ GOMME
                        </button>
                        <button class="tool-btn" onclick="clearAll()" style="margin-left: auto; border-color: rgba(255, 0, 0, 0.3); color: #ff6b6b;">
                            üóëÔ∏è TOUT EFFACER
                        </button>
                    </div>
                </div>

                <!-- Centre de D√©fis -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚ö°</div>
                        <div>
                            <h3 class="card-title">Centre de D√©fis</h3>
                            <p class="card-subtitle">Jeux et interactions en direct</p>
                        </div>
                    </div>

                    <!-- Humeurs -->
                    <div class="game-box">
                        <div class="player-row">
                            <span class="player-badge badge-rayan">RAYAN</span>
                            <div class="mood-selector" id="moods-R">
                                <span class="mood-btn" onclick="pushMood('rayan','üòä')">üòä</span>
                                <span class="mood-btn" onclick="pushMood('rayan','üî•')">üî•</span>
                                <span class="mood-btn" onclick="pushMood('rayan','ü•∫')">ü•∫</span>
                                <span class="mood-btn" onclick="pushMood('rayan','üò¥')">üò¥</span>
                                <span class="mood-btn" onclick="pushMood('rayan','ü•∞')">ü•∞</span>
                            </div>
                        </div>
                        <div class="player-row">
                            <span class="player-badge badge-israh">ISRAH</span>
                            <div class="mood-selector" id="moods-I">
                                <span class="mood-btn" onclick="pushMood('israh','üòä')">üòä</span>
                                <span class="mood-btn" onclick="pushMood('israh','üî•')">üî•</span>
                                <span class="mood-btn" onclick="pushMood('israh','ü•∫')">ü•∫</span>
                                <span class="mood-btn" onclick="pushMood('israh','üò¥')">üò¥</span>
                                <span class="mood-btn" onclick="pushMood('israh','ü•∞')">ü•∞</span>
                            </div>
                        </div>
                    </div>

                    <!-- Pierre-Papier-Ciseaux -->
                    <div class="game-box rps-game">
                        <span style="font-size:0.7rem; font-weight:800; opacity:0.5; letter-spacing:1px;">CHIFOUMI DIRECT</span>
                        <div class="rps-choices">
                            <span class="rps-choice" onclick="playRPS('ü™®')">ü™®</span>
                            <span class="rps-choice" onclick="playRPS('üìú')">üìú</span>
                            <span class="rps-choice" onclick="playRPS('‚úÇÔ∏è')">‚úÇÔ∏è</span>
                        </div>
                        <div id="rps-result" class="rps-result">Faites votre choix...</div>
                    </div>

                    <!-- Morpion -->
                    <div class="game-box">
                        <span style="font-size:0.7rem; font-weight:800; opacity:0.5;">MORPION (R:X | I:O)</span>
                        <div class="ttt-grid" id="ttt-grid"></div>
                        <button class="reset-btn" onclick="resetGames()">R√âINITIALISER LES JEUX</button>
                    </div>
                </div>
            </div>

            <!-- Grille des journaux -->
            <div class="journals-grid">
                <!-- Journal de Rayan -->
                <div class="card">
                    <div class="journal-header">
                        <h3 class="card-title">Journal de Rayan</h3>
                        <div class="journal-status">
                            <div id="dotR" class="status-dot-journal"></div>
                            <span style="font-size:0.7rem; color:var(--text-tertiary);">STATUT</span>
                        </div>
                    </div>
                    
                    <div class="question-box">
                        <div class="question-header">
                            <span class="question-label">QUESTION DE L'√ÇME</span>
                            <button class="roll-btn" onclick="rollQ()">üé≤</button>
                        </div>
                        <p id="q-txt-R" class="soul-question">Lance le d√© pour une question...</p>
                        <textarea id="rQ" class="journal-textarea" placeholder="Ta r√©ponse ici..." rows="2"></textarea>
                    </div>
                    
                    <textarea id="r1" class="journal-textarea" placeholder="Aujourd'hui j'ai gard√© pour moi‚Ä¶" rows="3"></textarea>
                    <textarea id="r2" class="journal-textarea" placeholder="J'ai √©t√© fier de‚Ä¶" rows="3"></textarea>
                    <textarea id="r3" class="journal-textarea" placeholder="J'aurais aim√© te dire‚Ä¶" rows="3"></textarea>
                    <textarea id="r4" class="journal-textarea" placeholder="Quelque chose m'a bless√©‚Ä¶" rows="3"></textarea>
                    <textarea id="r5" class="journal-textarea" placeholder="J'ai manqu√© de‚Ä¶" rows="3"></textarea>
                    
                    <button class="seal-btn" onclick="seal('Rayan')">Sceller pour Israh üñ§</button>
                </div>

                <!-- Journal d'Israh -->
                <div class="card">
                    <div class="journal-header">
                        <h3 class="card-title">Journal d'Israh</h3>
                        <div class="journal-status">
                            <div id="dotI" class="status-dot-journal"></div>
                            <span style="font-size:0.7rem; color:var(--text-tertiary);">STATUT</span>
                        </div>
                    </div>
                    
                    <div class="question-box">
                        <div class="question-header">
                            <span class="question-label">QUESTION DE L'√ÇME</span>
                            <!-- Pas de bouton d√© pour Israh (seul Rayan peut lancer) -->
                        </div>
                        <p id="q-txt-I" class="soul-question">En attente de question...</p>
                        <textarea id="iQ" class="journal-textarea" placeholder="Ta r√©ponse ici..." rows="2"></textarea>
                    </div>
                    
                    <textarea id="i1" class="journal-textarea" placeholder="Aujourd'hui j'ai gard√© pour moi‚Ä¶" rows="3"></textarea>
                    <textarea id="i2" class="journal-textarea" placeholder="J'ai √©t√© fi√®re de‚Ä¶" rows="3"></textarea>
                    <textarea id="i3" class="journal-textarea" placeholder="J'aurais aim√© te dire‚Ä¶" rows="3"></textarea>
                    <textarea id="i4" class="journal-textarea" placeholder="Quelque chose m'a bless√©e‚Ä¶" rows="3"></textarea>
                    <textarea id="i5" class="journal-textarea" placeholder="J'ai manqu√© de‚Ä¶" rows="3"></textarea>
                    
                    <button class="seal-btn israh" onclick="seal('Israh')">Sceller pour Rayan üñ§</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-icon" id="modal-icon">‚ú®</div>
            <h2 id="modal-title" class="modal-title">Scell√© !</h2>
            <p id="modal-message" class="modal-message">Votre journal a √©t√© scell√© avec succ√®s.</p>
            <button class="modal-close" onclick="closeModal()">Fermer</button>
        </div>
    </div>

    <script>
        // ============ CONFIGURATION FIREBASE ============
        const firebaseConfig = {
            apiKey: "AIzaSyBPNfMyhIOTWyGG-ZB5pOTr-y3TA0J3B28",
            authDomain: "mon-projet062.firebaseapp.com",
            databaseURL: "https://mon-projet062-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mon-projet062",
            storageBucket: "mon-projet062.appspot.com",
            messagingSenderId: "1054174163421",
            appId: "1:1054174163421:web:50817b3c930a5eb55ac634"
        };
        
        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // ============ VARIABLES GLOBALES ============
        let currentUser = "";
        let syncClicks = 0;
        let currentTool = "draw";
        const soulQuestions = [
            "Ton moment pr√©f√©r√© avec moi ?",
            "Une chose que tu aimes chez moi ?",
            "Un d√©fi que tu veux relever demain ?",
            "Ton humeur en un seul mot ?",
            "De quoi es-tu fier(e) aujourd'hui ?",
            "Un souvenir qui t'a fait sourire r√©cemment ?",
            "Quelque chose que tu as appris sur toi-m√™me ?",
            "Ce qui te rend reconnaissant(e) en ce moment ?"
        ];

        // ============ FONCTIONS D'AUTHENTIFICATION ============
        function identify(user) {
            currentUser = user;
            document.getElementById('auth-screen').style.opacity = '0';
            document.getElementById('auth-screen').style.transform = 'scale(1.1)';
            
            setTimeout(() => {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('sync-screen').classList.add('active');
                document.getElementById('welcome-text').textContent = `Bonjour, ${user}`;
                
                // Mettre √† jour l'indicateur utilisateur
                const indicator = document.getElementById('user-indicator');
                indicator.textContent = `Connect√© en tant que ${user}`;
                indicator.className = `user-indicator ${user.toLowerCase()}`;
            }, 500);
        }

        function heartStep() {
            syncClicks++;
            const heart = document.getElementById('sync-heart');
            const count = document.getElementById('sync-count');
            
            // Animation du c≈ìur
            heart.style.transform = `scale(${1 + syncClicks * 0.1})`;
            count.textContent = syncClicks;
            
            // Confetti apr√®s chaque clic
            confetti({
                particleCount: 50,
                spread: 70,
                origin: { y: 0.6 }
            });
            
            if (syncClicks >= 5) {
                document.getElementById('sync-instruction').textContent = 'SYNCHRONISATION TERMIN√âE !';
                document.getElementById('sync-heart').textContent = '‚ú®';
                document.getElementById('sync-heart').style.background = 'linear-gradient(45deg, var(--accent-green), var(--accent-blue))';
                
                setTimeout(() => {
                    document.getElementById('sync-screen').classList.remove('active');
                    document.getElementById('main-app').style.display = 'block';
                    initApp();
                }, 1000);
            }
        }

        function logout() {
            if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {
                document.getElementById('main-app').style.display = 'none';
                document.getElementById('auth-screen').style.display = 'flex';
                document.getElementById('auth-screen').style.opacity = '1';
                document.getElementById('auth-screen').style.transform = 'scale(1)';
                currentUser = '';
                syncClicks = 0;
            }
        }

        // ============ INITIALISATION DE L'APP ============
        function initApp() {
            // Initialiser le jardin
            initGarden();
            
            // Initialiser le morpion
            initTicTacToe();
            
            // Mettre √† jour l'horloge
            updateClock();
            setInterval(updateClock, 1000);
            
            // √âcouter les changements Firebase
            setupFirebaseListeners();
        }

        // ============ JARDIN DE CRISTAL ============
        function initGarden() {
            const grid = document.getElementById('garden-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 144; i++) {
                const pixel = document.createElement('div');
                pixel.className = 'pixel';
                pixel.dataset.index = i;
                
                pixel.addEventListener('click', () => {
                    handlePixelClick(i);
                });
                
                grid.appendChild(pixel);
            }
        }

        function setTool(tool) {
            currentTool = tool;
            
            // Mettre √† jour les boutons
            document.getElementById('btn-draw').classList.toggle('active', tool === 'draw');
            document.getElementById('btn-erase').classList.toggle('active', tool === 'erase');
        }

        function handlePixelClick(index) {
            let color = null;
            
            if (currentTool === 'draw') {
                color = currentUser === 'Rayan' ? 
                    'var(--accent-purple)' : 
                    'var(--accent-pink)';
            }
            
            // Envoyer √† Firebase
            database.ref(`harmonie_v3/garden/${index}`).set(color);
        }

        function clearAll() {
            if (confirm('Voulez-vous vraiment effacer tout le jardin ? Cette action est irr√©versible.')) {
                database.ref('harmonie_v3/garden').remove();
            }
        }

        // ============ MORPION ============
        function initTicTacToe() {
            const grid = document.getElementById('ttt-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'ttt-cell';
                cell.dataset.index = i;
                
                cell.addEventListener('click', () => {
                    handleTicTacToeClick(i);
                });
                
                grid.appendChild(cell);
            }
        }

        function handleTicTacToeClick(index) {
            const symbol = currentUser === 'Rayan' ? 'X' : 'O';
            database.ref(`harmonie_v3/ttt/${index}`).set(symbol);
        }

        // ============ JEUX ============
        function pushMood(user, mood) {
            database.ref(`harmonie_v3/moods/${user}`).set(mood);
        }

        function playRPS(choice) {
            database.ref(`harmonie_v3/rps/${currentUser.toLowerCase()}`).set(choice);
        }

        function resetGames() {
            if (confirm('R√©initialiser tous les jeux ?')) {
                database.ref('harmonie_v3/ttt').remove();
                database.ref('harmonie_v3/rps').remove();
            }
        }

        function rollQ() {
            if (currentUser === 'Rayan') {
                const randomQuestion = soulQuestions[Math.floor(Math.random() * soulQuestions.length)];
                database.ref('harmonie_v3/qSoul').set(randomQuestion);
            }
        }

        // ============ JOURNAUX ============
        function seal(user) {
            // Marquer comme compl√©t√©
            database.ref(`harmonie_v3/done/${user}`).set(true);
            
            // Afficher le modal
            document.getElementById('modal').classList.add('active');
            document.getElementById('modal-title').textContent = 'Journal Scell√© !';
            document.getElementById('modal-message').textContent = 
                `Ton c≈ìur a parl√©, ${user}. Les pens√©es sont envoy√©es et le signal est pass√© au vert pour ton partenaire.`;
            
            // Lancer des confettis
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // ============ SYNC AVEC FIREBASE ============
        function setupFirebaseListeners() {
            database.ref('harmonie_v3').on('value', (snapshot) => {
                const data = snapshot.val() || {};
                
                // Synchroniser le jardin
                if (data.garden) {
                    document.querySelectorAll('.pixel').forEach(pixel => {
                        const index = pixel.dataset.index;
                        const color = data.garden[index] || null;
                        
                        if (color) {
                            pixel.style.background = color;
                            pixel.style.boxShadow = `0 0 15px ${color}80`;
                        } else {
                            pixel.style.background = 'rgba(255, 255, 255, 0.03)';
                            pixel.style.boxShadow = 'none';
                        }
                    });
                }
                
                // Synchroniser les humeurs
                ['rayan', 'israh'].forEach(user => {
                    const mood = data.moods?.[user];
                    const selector = document.getElementById(`moods-${user === 'rayan' ? 'R' : 'I'}`);
                    
                    if (selector) {
                        selector.querySelectorAll('.mood-btn').forEach(btn => {
                            btn.classList.toggle('active', btn.textContent === mood);
                        });
                    }
                });
                
                // Synchroniser RPS
                const rpsData = data.rps || {};
                const resultDiv = document.getElementById('rps-result');
                
                if (rpsData.rayan && rpsData.israh) {
                    // D√©terminer le gagnant
                    const winner = getRPSWinner(rpsData.rayan, rpsData.israh);
                    resultDiv.textContent = `R: ${rpsData.rayan} vs I: ${rpsData.israh} - ${winner}`;
                } else if (rpsData.rayan || rpsData.israh) {
                    resultDiv.textContent = 'Un joueur a choisi...';
                } else {
                    resultDiv.textContent = 'Faites votre choix...';
                }
                
                // Synchroniser le morpion
                if (data.ttt) {
                    document.querySelectorAll('.ttt-cell').forEach(cell => {
                        const index = cell.dataset.index;
                        const value = data.ttt[index] || '';
                        
                        cell.textContent = value;
                        cell.style.color = value === 'X' ? 'var(--accent-purple)' : 'var(--accent-pink)';
                    });
                }
                
                // Synchroniser les journaux
                if (data.qSoul) {
                    document.getElementById('q-txt-R').textContent = data.qSoul;
                    document.getElementById('q-txt-I').textContent = data.qSoul;
                }
                
                // Synchroniser l'√©tat des journaux
                document.getElementById('dotR').classList.toggle('active', data.done?.Rayan);
                document.getElementById('dotI').classList.toggle('active', data.done?.Israh);
                
                // Synchroniser les textareas (si l'utilisateur n'est pas en train d'√©crire dedans)
                syncTextarea('r', data.valR);
                syncTextarea('i', data.valI);
                
                // Mettre √† jour la barre de progression
                updateXPBar();
            });
        }

        function syncTextarea(prefix, values) {
            if (!values) return;
            
            // Champs 1-5
            for (let i = 1; i <= 5; i++) {
                const textarea = document.getElementById(`${prefix}${i}`);
                if (textarea && document.activeElement !== textarea) {
                    textarea.value = values[i-1] || '';
                }
            }
            
            // Question
            const qTextarea = document.getElementById(`${prefix}Q`);
            if (qTextarea && document.activeElement !== qTextarea) {
                qTextarea.value = values[5] || '';
            }
        }

        // Fonction pour enregistrer automatiquement les textareas
        function setupTextareaAutoSave() {
            document.querySelectorAll('.journal-textarea').forEach(textarea => {
                textarea.addEventListener('input', function() {
                    const id = this.id;
                    const prefix = id.charAt(0); // 'r' ou 'i'
                    const num = id.slice(1); // '1', '2', 'Q', etc.
                    
                    // Construire le tableau des valeurs
                    const values = [];
                    for (let i = 1; i <= 5; i++) {
                        values.push(document.getElementById(`${prefix}${i}`)?.value || '');
                    }
                    values.push(document.getElementById(`${prefix}Q`)?.value || '');
                    
                    // Envoyer √† Firebase
                    database.ref(`harmonie_v3/val${prefix.toUpperCase()}`).set(values);
                });
            });
        }

        // ============ UTILITAIRES ============
        function getRPSWinner(choice1, choice2) {
            if (choice1 === choice2) return '√âgalit√© !';
            
            const rules = {
                'ü™®': '‚úÇÔ∏è',
                'üìú': 'ü™®',
                '‚úÇÔ∏è': 'üìú'
            };
            
            return rules[choice1] === choice2 ? 'Rayan gagne !' : 'Israh gagne !';
        }

        function updateXPBar() {
            let filledCount = 0;
            const totalTextareas = document.querySelectorAll('.journal-textarea').length;
            
            document.querySelectorAll('.journal-textarea').forEach(textarea => {
                if (textarea.value.trim().length > 3) {
                    filledCount++;
                }
            });
            
            const percentage = Math.round((filledCount / totalTextareas) * 100);
            document.getElementById('xp-fill').style.width = `${percentage}%`;
            document.getElementById('xp-percent').textContent = `${percentage}%`;
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            document.getElementById('real-clock').textContent = timeString;
            
            // Calculer le temps jusqu'√† minuit
            const midnight = new Date();
            midnight.setHours(24, 0, 0, 0);
            const diff = midnight - now;
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            document.getElementById('countdown').textContent = `Reset dans ${hours}h ${minutes}m`;
            
            // R√©initialiser √† minuit
            if (hours === 0 && minutes === 0 && now.getSeconds() < 10) {
                database.ref('harmonie_v3').remove();
                setTimeout(() => {
                    alert('Le syst√®me a √©t√© r√©initialis√© pour la nouvelle journ√©e !');
                    location.reload();
                }, 1000);
            }
        }

        // ============ INITIALISATION ============
        document.addEventListener('DOMContentLoaded', function() {
            // V√©rifier si l'utilisateur est d√©j√† connect√© (dans le localStorage)
            const savedUser = localStorage.getItem('harmonie_user');
            if (savedUser) {
                identify(savedUser);
            }
            
            // Configurer l'auto-sauvegarde des textareas
            setupTextareaAutoSave();
        });
    </script>
</body>
</html> 
