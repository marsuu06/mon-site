<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rituel 22h ðŸŒ™ | Connexion Intime</title>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBPNfMyhIOTWyGG-ZB5pOTr-y3TA0J3B28",
            authDomain: "mon-projet062.firebaseapp.com",
            databaseURL: "https://mon-projet062-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mon-projet062",
            storageBucket: "mon-projet062.appspot.com",
            messagingSenderId: "1054174163421",
            appId: "1:1054174163421:web:50817b3c930a5eb55ac634"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap');

        :root {
            --rayan-color: #7d5fff;
            --israh-color: #ff4dff;
            --bg-dark: #090912;
            --glass: rgba(255, 255, 255, 0.07);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-dark);
            color: white;
            margin: 0;
            overflow-x: hidden;
            background: radial-gradient(circle at center, #1a1a2e 0%, #090912 100%);
        }

        /* --- Interface de Progression --- */
        .header-status {
            position: sticky; top: 0; z-index: 100;
            background: rgba(9, 9, 18, 0.8); backdrop-filter: blur(10px);
            padding: 15px; text-align: center; border-bottom: 1px solid var(--glass);
        }

        .xp-bar-container {
            width: 80%; height: 8px; background: #222; margin: 10px auto;
            border-radius: 10px; position: relative; overflow: hidden;
        }
        #xp-fill {
            width: 0%; height: 100%; 
            background: linear-gradient(90deg, var(--rayan-color), var(--israh-color));
            box-shadow: 0 0 15px var(--rayan-color); transition: width 0.8s ease;
        }

        /* --- Cartes & Layout --- */
        .main-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px; padding: 20px; max-width: 1200px; margin: auto;
        }

        .card {
            background: var(--glass); border-radius: 30px; padding: 25px;
            border: 1px solid rgba(255,255,255,0.1); position: relative;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .card:hover { transform: translateY(-5px); border-color: rgba(255,255,255,0.3); }

        .card.rayan { border-left: 5px solid var(--rayan-color); }
        .card.israh { border-left: 5px solid var(--israh-color); }

        h2 { font-size: 1.8rem; margin-bottom: 5px; display: flex; align-items: center; justify-content: space-between; }

        /* --- Inputs StylisÃ©s --- */
        .input-group { margin-bottom: 15px; }
        label { font-size: 0.85rem; opacity: 0.6; display: block; margin-bottom: 5px; margin-left: 5px; }

        textarea {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px; color: white; padding: 12px; font-family: inherit;
            resize: none; transition: 0.3s; box-sizing: border-box;
        }
        textarea:focus { outline: none; border-color: var(--rayan-color); background: rgba(0,0,0,0.5); }

        /* --- Mini Jeux --- */
        .game-box {
            background: rgba(255,255,255,0.03); border-radius: 20px; padding: 15px;
            margin: 20px 0; border: 1px dashed rgba(255,255,255,0.2); text-align: center;
        }
        .question-display { font-style: italic; color: #cbd5e0; min-height: 40px; margin-bottom: 10px; }

        .btn {
            background: white; color: black; border: none; padding: 10px 20px;
            border-radius: 50px; cursor: pointer; font-weight: 600; transition: 0.3s;
        }
        .btn:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(255,255,255,0.2); }
        .btn-mini { padding: 5px 15px; font-size: 0.8rem; }

        /* --- Ã‰tats --- */
        .status-badge { font-size: 0.7rem; padding: 4px 10px; border-radius: 10px; text-transform: uppercase; }
        .done { background: #4caf50; color: white; }
        .pending { background: #ff9800; color: white; }

        #timer { font-family: monospace; color: var(--israh-color); font-weight: bold; }

        .hidden { display: none; }

        /* Animation de succÃ¨s final */
        #final-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; display: none;
        }
    </style>
</head>
<body>

    <div class="header-status">
        <div id="timer">00:00:00</div>
        <div class="xp-bar-container"><div id="xp-fill"></div></div>
        <small id="xp-text">Niveau d'harmonie : 0%</small>
    </div>

    <div id="intro-screen" style="text-align: center; padding: 50px;">
        <h1>ðŸŒ™ Rituel Interactif</h1>
        <p>PrÃªt pour votre moment de connexion ?</p>
        <button class="btn" onclick="startRitual()">Ouvrir le portail</button>
    </div>

    <div id="ritual-zone" class="hidden">
        <div class="main-grid">
            
            <div class="card rayan">
                <h2>Rayan <span id="badgeRayan" class="status-badge pending">En cours</span></h2>
                
                <div class="game-box">
                    <div id="qRayan" class="question-display">Appuie sur le dÃ© pour un dÃ©fi...</div>
                    <button class="btn btn-mini" onclick="generateQ('Rayan')">ðŸŽ² Question</button>
                    <button class="btn btn-mini" onclick="generateChallenge('Rayan')">ðŸ”¥ DÃ©fi</button>
                    <textarea id="rayanQAns" placeholder="RÃ©ponse au dÃ©fi..." style="margin-top:10px"></textarea>
                </div>

                <div class="input-group">
                    <label>Aujourd'hui, j'ai gardÃ© pour moi...</label>
                    <textarea id="r1"></textarea>
                </div>
                <div class="input-group">
                    <label>J'ai Ã©tÃ© fier de...</label>
                    <textarea id="r2"></textarea>
                </div>
                <div class="input-group">
                    <label>J'ai manquÃ© de...</label>
                    <textarea id="r3"></textarea>
                </div>
                <button class="btn" style="width:100%; background:var(--rayan-color); color:white" onclick="markDone('Rayan')">Terminer le rituel</button>
            </div>

            <div class="card israh">
                <h2>Israh <span id="badgeIsrah" class="status-badge pending">En cours</span></h2>

                <div class="game-box">
                    <div id="qIsrah" class="question-display">Appuie sur le dÃ© pour un dÃ©fi...</div>
                    <button class="btn btn-mini" onclick="generateQ('Israh')">ðŸŽ² Question</button>
                    <button class="btn btn-mini" onclick="generateChallenge('Israh')">ðŸ”¥ DÃ©fi</button>
                    <textarea id="israhQAns" placeholder="RÃ©ponse au dÃ©fi..." style="margin-top:10px"></textarea>
                </div>

                <div class="input-group">
                    <label>Aujourd'hui, j'ai gardÃ© pour moi...</label>
                    <textarea id="i1"></textarea>
                </div>
                <div class="input-group">
                    <label>J'ai Ã©tÃ© fiÃ¨re de...</label>
                    <textarea id="i2"></textarea>
                </div>
                <div class="input-group">
                    <label>J'ai manquÃ© de...</label>
                    <textarea id="i3"></textarea>
                </div>
                <button class="btn" style="width:100%; background:var(--israh-color); color:white" onclick="markDone('Israh')">Terminer le rituel</button>
            </div>

        </div>
    </div>

    <div id="final-overlay">
        <h1 style="font-size: 3rem;">âœ¨ Connexion Ã‰tablie âœ¨</h1>
        <p>Vos Ã¢mes sont synchronisÃ©es pour la nuit.</p>
        <button class="btn" onclick="document.getElementById('final-overlay').style.display='none'">Voir les rÃ©ponses</button>
    </div>

<script>
    const questions = ["Ton moment prÃ©fÃ©rÃ© de nous ?", "Un rÃªve bizarre rÃ©current ?", "La chanson qui te fait penser Ã  moi ?", "Si on Ã©tait des animaux ?", "Ton plus grand fou rire ?"];
    const challenges = ["Envoie un selfie grimace maintenant", "Dis-moi 3 choses que tu aimes chez moi", "Chuchote un secret en audio", "PrÃ©dit ma journÃ©e de demain"];

    let state = { Rayan: false, Israh: false };

    function startRitual() {
        document.getElementById('intro-screen').classList.add('hidden');
        document.getElementById('ritual-zone').classList.remove('hidden');
        updateXP();
    }

    function generateQ(user) {
        document.getElementById('q'+user).innerText = questions[Math.floor(Math.random()*questions.length)];
        save();
    }

    function generateChallenge(user) {
        document.getElementById('q'+user).innerText = "ðŸ”¥ DEFI : " + challenges[Math.floor(Math.random()*challenges.length)];
        save();
    }

    function updateXP() {
        const textareas = document.querySelectorAll('textarea');
        let filled = 0;
        textareas.forEach(t => { if(t.value.length > 2) filled++ });
        let percent = (filled / textareas.length) * 100;
        document.getElementById('xp-fill').style.width = percent + "%";
        document.getElementById('xp-text').innerText = "Harmonie du couple : " + Math.floor(percent) + "%";
    }

    function markDone(user) {
        state[user] = true;
        document.getElementById('badge' + user).innerText = "TerminÃ© âœ…";
        document.getElementById('badge' + user).className = "status-badge done";
        save();
        if(state.Rayan && state.Israh) {
            document.getElementById('final-overlay').style.display = 'flex';
        }
    }

    function save() {
        const data = {
            r: [document.getElementById('r1').value, document.getElementById('r2').value, document.getElementById('r3').value, document.getElementById('qRayan').innerText, document.getElementById('rayanQAns').value],
            i: [document.getElementById('i1').value, document.getElementById('i2').value, document.getElementById('i3').value, document.getElementById('qIsrah').innerText, document.getElementById('israhQAns').value],
            status: state
        };
        database.ref('rituel_pousse').set(data);
        updateXP();
    }

    // Timer Auto-destruction
    setInterval(() => {
        const now = new Date();
        const diff = new Date().setHours(24,0,0,0) - now;
        const h = Math.floor(diff/3600000);
        const m = Math.floor((diff%3600000)/60000);
        const s = Math.floor((diff%60000)/1000);
        document.getElementById('timer').innerText = `FERMETURE DANS : ${h}h ${m}m ${s}s`;
        if(diff <= 0) database.ref('rituel_pousse').remove();
    }, 1000);

    document.querySelectorAll('textarea').forEach(t => t.addEventListener('input', save));
</script>
</body>
</html>
